<!-- ================== HEADER ================== -->
<div class="d-flex justify-content-between align-items-center mb-3">
    
    <h5 class="fw-bold">
        <i class="fas fa-shield-halved me-2 text-orange"></i>
        {{ theme.name }}
    </h5>

    {% if show_admin_actions %}
    <div class="d-flex gap-2">

        <!-- Add Event -->
        <button class="btn btn-sm btn-orange"
                onclick="openAddEventOffcanvas({{ theme.id }});">
            <i class="fas fa-plus me-1"></i>Add Event
        </button>

        <!-- Edit -->
        <a href="{% url 'edit_theme' pk=theme.pk %}" 
           class="btn btn-warning btn-sm fw-semibold">
           <i class="fas fa-edit me-1"></i>Edit
        </a>

        <!-- Archive / Restore -->
        <form method="post"
              action="{% url 'toggle_theme_active' pk=theme.pk %}"
              class="d-inline">
            {% csrf_token %}
            <button type="submit"
                    class="btn btn-outline-{{ theme.is_active|yesno:'danger,success' }} btn-sm fw-semibold"
                    onclick="return confirm('{{ theme.is_active|yesno:"Archive this threat?,Restore this threat?" }}');">
                <i class="fas fa-{{ theme.is_active|yesno:'archive,rotate-left' }} me-1"></i>
                {{ theme.is_active|yesno:'Archive,Restore' }}
            </button>
        </form>

    </div>
    {% endif %}
</div>


<!-- ================== DETAILS SECTION ================== -->
<div class="theme-details-container mb-4 p-3 bg-light rounded">

    <h6 class="fw-bold border-bottom pb-2 mb-3 text-muted">
        Threat Details
    </h6>

    <div class="row g-3">

        <!-- Category -->
        <div class="col-12">
            <div class="detail-card p-3 bg-white rounded shadow-sm">
                <strong class="text-muted">
                    <i class="fas fa-folder-open text-primary me-2"></i>Category
                </strong>
                <p class="fw-bold mb-0">{{ theme.category }}</p>
            </div>
        </div>

        <!-- Risk Rating -->
        <div class="col-12">
            <div class="detail-card p-3 bg-white rounded shadow-sm">
                <strong class="text-muted">
                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>Risk Rating
                </strong>
                <span class="badge bg-{{ theme.get_risk_color }} p-2">
                    {{ theme.get_risk_rating_display }}
                </span>
            </div>
        </div>

        <!-- Onset Timeline -->
        <div class="col-12">
            <div class="detail-card p-3 bg-white rounded shadow-sm">
                <strong class="text-muted">
                    <i class="fas fa-clock text-info me-2"></i>Onset Timeline
                </strong>
                <p class="fw-bold mb-0">
                    {{ theme.get_onset_timeline_display|default:"Not specified" }}
                </p>
            </div>
        </div>

        <!-- Events Count -->
        <div class="col-12">
            <div class="detail-card p-3 bg-white rounded shadow-sm">
                <strong class="text-muted">
                    <i class="fas fa-calendar-alt text-success me-2"></i>Events
                </strong>
                <p class="fw-bold mb-0">{{ theme.events.count }} events</p>
            </div>
        </div>

    </div>
</div>


<!-- ================== RELATED EVENTS ================== -->
<h6 class="fw-bold mb-2">
    <i class="fas fa-list-ul me-2 text-orange"></i>Related Events
</h6>

{% if theme.events.count %}
<div class="table-responsive" style="max-height: 320px; overflow-y:auto;">
    <table class="table table-sm table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Risk</th>
            </tr>
        </thead>
        <tbody>
            {% for event in theme.events.all %}
            <tr>
                <td>{{ event.name }}</td>
                <td>{{ event.date_identified|date:"m-d-Y" }}</td>
                <td>
                    <span class="badge bg-{{ event.get_risk_color }}">
                        {{ event.get_risk_rating_display }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="alert alert-info text-center py-4">
    <i class="fas fa-info-circle me-2"></i>
    No events added yet.
</div>
{% endif %}
